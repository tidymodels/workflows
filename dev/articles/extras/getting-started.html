<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started • workflows</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../../favicon.ico">
<link rel="manifest" href="../../site.webmanifest">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Getting Started">
<meta name="robots" content="noindex">
<script defer data-domain="workflows.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">workflows</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../articles/stages.html">Workflow Stages</a></li>
<li class="active nav-item"><a class="nav-link" href="../../articles/extras/getting-started.html">Getting Started</a></li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/workflows/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Getting Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/workflows/blob/main/vignettes/extras/getting-started.Rmd" class="external-link"><code>vignettes/extras/getting-started.Rmd</code></a></small>
      <div class="d-none name"><code>getting-started.Rmd</code></div>
    </div>

    
    
<p>This is an example of a fairly realistic interactive data analysis
project to demonstrate how workflows can be used.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this <code>bivariate</code> data set, there are two predictors
that can be used to differentiate two classes in the outcome.</p>
<p>There are three partitions of the original data: training (n = 1009),
validation (n = 300), and testing (n = 710). We will work with the
training set the most, use the validation set to compare models during
the development process, and then use the test set once we think that we
have a good algorithm for making predictions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeldata.tidymodels.org" class="external-link">modeldata</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'modeldata'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:datasets':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     penguins</span></span>
<span></span>
<span><span class="co"># This gives us access to the 3 partitions:</span></span>
<span><span class="co"># - `bivariate_train`: Training set</span></span>
<span><span class="co"># - `bivariate_val`: Validation set</span></span>
<span><span class="co"># - `bivariate_test`: Test set</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"bivariate"</span><span class="op">)</span></span></code></pre></div>
<p>Here is the training set:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflows" class="external-link">workflows</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bivariate_train</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">A</span>, y <span class="op">=</span> <span class="va">B</span>, col <span class="op">=</span> <span class="va">Class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/plot-data-1.png" alt="A ggplot dotplot with predictor 'A' on the x axis and 'B' on the y, demonstrating a positive, linear, moderately strong correlation. Dots are colored according to two classes, red for 'One' and blue for 'Two', and the red dots tend to have slightly larger values of 'B' for given values of 'A', though the separation is far from perfect." width="768"></p>
<p>Both predictors have positive values and their distributions are
right-skewed. There seems to be a separation of the classes, but only
when the variables are used together. For example, when the predictors
are visualized individually, there is little evidence in separation of
the classes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">bivariate_train</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"predictor"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Class</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">predictor</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/plot-marginals-1.png" alt="A pair of boxplots showing the same predictors, this time one at a time. The predictors on their own do little to separate the two outcome classes." width="768"></p>
<p>In the first plot above, the separation appears to happen linearly,
and a straight, diagonal boundary might do well. We could use
<code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> directly to create a logistic regression, but we will
use the <code>tidymodels</code> infrastructure and start by making a
<code>parsnip</code> model object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">logit_mod</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/logistic_reg.html" class="external-link">logistic_reg</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"glm"</span><span class="op">)</span></span></code></pre></div>
<p>This data analysis will involve looking at a few different approaches
of representing the two predictors so that we have a high-quality model.
We’ll walk though the thought process of this analysis as we go. This
will emulate how most data analysis projects happen: an initial approach
is taken and then potential steps are attempted to make improvements.
There is no pre-defined blueprint to this process and the R4DS diagram
summarizes the process nicely.</p>
<p>Since we are going to try different combinations of feature
engineering and models, <code>workflows</code> are really useful since
you can have one object that contains all of these operations. It helps
organize your work instead of having different objects in your workspace
that, at some point, have been used in pairs.</p>
</div>
<div class="section level2">
<h2 id="a-first-set-of-models">A first set of models<a class="anchor" aria-label="anchor" href="#a-first-set-of-models"></a>
</h2>
<p>The obvious place to start is by adding both predictors as-is into
the model:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a workflow with just the model. We will add to this as we go. </span></span>
<span><span class="va">glm_workflow</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../../reference/workflow.html">workflow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../reference/add_model.html">add_model</a></span><span class="op">(</span><span class="va">logit_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simple_glm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">glm_workflow</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Add both predictors in</span></span>
<span>  <span class="fu"><a href="../../reference/add_formula.html">add_formula</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Fit the model:</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bivariate_train</span><span class="op">)</span></span></code></pre></div>
<p>To evaluate this model, the ROC curve will be computed along with its
corresponding AUC.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/yardstick" class="external-link">yardstick</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">simple_glm_probs</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">simple_glm</span>, <span class="va">bivariate_val</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">bivariate_val</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simple_glm_roc</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">simple_glm_probs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_curve.html" class="external-link">roc_curve</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_One</span><span class="op">)</span></span>
<span></span>
<span><span class="va">simple_glm_probs</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_auc.html" class="external-link">roc_auc</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_One</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> roc_auc binary         0.773</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">simple_glm_roc</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/simple-roc-1.png" alt="A ggplot2 line plot, with 1 minus specificity on the x axis, sensitivity on the y, and a dotted line tracing the y equals x line. A solid line is shown always above the dotted line, with greatest separation from it towards the center of the plot." width="768"></p>
<p>This seems reasonable. One potential issue is that the two predictors
have a high degree of correlation 0.848, and this might cause some
instability in the model.</p>
<p>Since there are two correlated predictors with skewed distributions
and strictly positive values, it might be intuitive to use their ratio
instead of the pair. We’ll try that next by recycling the initial
workflow and just adding a different formula:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ratio_glm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">glm_workflow</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../reference/add_formula.html">add_formula</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">A</span><span class="op">/</span><span class="va">B</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bivariate_train</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ratio_glm_probs</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">ratio_glm</span>, <span class="va">bivariate_val</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">bivariate_val</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ratio_glm_roc</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">ratio_glm_probs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_curve.html" class="external-link">roc_curve</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_One</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ratio_glm_probs</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_auc.html" class="external-link">roc_auc</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_One</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> roc_auc binary         0.765</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">simple_glm_roc</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">ratio_glm_roc</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">specificity</span>, y <span class="op">=</span> <span class="va">sensitivity</span><span class="op">)</span>, </span>
<span>    col <span class="op">=</span> <span class="st">"#FDE725FF"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/ratios-1.png" alt="The same plot as before, this time with a yellow line also added to the plot. The yellow line roughly traces the solid black one, except that it's y values are slightly higher than those of the solid black line towards the left portion of the plot and vice versa for the other portion." width="768"></p>
<p>The original analysis shows a slight edge, but the two models are
probably within the experimental noise of one another.</p>
</div>
<div class="section level2">
<h2 id="more-complex-feature-engineering">More complex feature engineering<a class="anchor" aria-label="anchor" href="#more-complex-feature-engineering"></a>
</h2>
<p>Instead of combining the two predictors, would it help the model if
we were to resolve the skewness of the variables? To test this theory,
one option would be to use the Box-Cox transformation on each predictor
individually to see if it recommends a nonlinear transformation. The
transformation can encode a variety of different functions including the
log transform, square root, inverse, and fractional transformations
in-between these.</p>
<p>This cannot be easily done via the formula interface, so a recipe is
used. A recipe is a list of sequential data processing steps that are
conducted before the data are used in a model. For example, to use the
Box-Cox method, a simple recipe would be:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">trans_recipe</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">bivariate_train</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_BoxCox.html" class="external-link">step_BoxCox</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Creating the recipe only makes an object with the instructions; it
does not carry out the instructions (e.g. estimate the transformation
parameter). To actually execute the recipe, we add it to our workflow
with <code><a href="../../reference/add_recipe.html">add_recipe()</a></code> and then call <code><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit()</a></code>. Fitting
the workflow evaluates both the model and the recipe.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans_glm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">glm_workflow</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../reference/add_recipe.html">add_recipe</a></span><span class="op">(</span><span class="va">trans_recipe</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bivariate_train</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trans_glm_probs</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">trans_glm</span>, <span class="va">bivariate_val</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">bivariate_val</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trans_glm_roc</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">trans_glm_probs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_curve.html" class="external-link">roc_curve</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_One</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trans_glm_probs</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_auc.html" class="external-link">roc_auc</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_One</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> roc_auc binary         0.815</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">simple_glm_roc</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">ratio_glm_roc</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">specificity</span>, y <span class="op">=</span> <span class="va">sensitivity</span><span class="op">)</span>, </span>
<span>    col <span class="op">=</span> <span class="st">"#FDE725FF"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">trans_glm_roc</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">specificity</span>, y <span class="op">=</span> <span class="va">sensitivity</span><span class="op">)</span>, </span>
<span>    col <span class="op">=</span> <span class="st">"#21908CFF"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/rec-trans-1.png" alt="The same plot as above, but with another line, shown in green, added to the plot. Its y values are nearly always consistently higher than the existing black and yellow lines." width="768"></p>
<p>That is a potential, if slight, improvement.</p>
<p>The Box-Cox procedure recommended transformations that are pretty
close to the inverse.</p>
<p>The model above creates a class boundary for these data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bivariate_train</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">A</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">B</span>, col <span class="op">=</span> <span class="va">Class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/plot-inverse-1.png" alt="A dotplot like that shown early on in the article, plotting the inverse of the previous two predictors and the same binary outcome variable. A boundary between the two outcome classes seems a bit more evident in this plot than before." width="768"></p>
<p>The correlation between these is about the same as in the original
data. It might help the model to de-correlate them, and the standard
technique for this is principal component analysis. A recipe step can be
added that will conduct PCA and return the score values. The scores,
instead of the original predictors, can then be used in the model. PCA
chases variability, so it is important to normalize the two predictors
so that they have the same units. Traditionally, each column could be
centered and scaled. For this reason, a step is used prior to PCA that
normalizes the two predictors.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca_recipe</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">trans_recipe</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html" class="external-link">step_normalize</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_pca.html" class="external-link">step_pca</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, num_comp <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pca_glm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">glm_workflow</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../reference/add_recipe.html">add_recipe</a></span><span class="op">(</span><span class="va">pca_recipe</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bivariate_train</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pca_glm_probs</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">pca_glm</span>, <span class="va">bivariate_val</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">bivariate_val</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pca_glm_roc</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">pca_glm_probs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_curve.html" class="external-link">roc_curve</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_One</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pca_glm_probs</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_auc.html" class="external-link">roc_auc</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_One</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> roc_auc binary         0.815</span></span></code></pre></div>
<p>These results are almost identical to the transformed model.</p>
</div>
<div class="section level2">
<h2 id="the-test-set">The test set<a class="anchor" aria-label="anchor" href="#the-test-set"></a>
</h2>
<p>Based on these results, the model with the logistic regression model
with inverse terms is probably our best bet. Using the test set:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_probs</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">trans_glm</span>, <span class="va">bivariate_test</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">bivariate_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_roc</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">test_probs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_curve.html" class="external-link">roc_curve</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_One</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A little more optimistic than the validation set</span></span>
<span><span class="va">test_probs</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://yardstick.tidymodels.org/reference/roc_auc.html" class="external-link">roc_auc</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_One</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> roc_auc binary         0.862</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">test_roc</span><span class="op">)</span> </span></code></pre></div>
<p><img src="getting-started_files/figure-html/test-set-1.png" alt="An ROC curve plot like before, back to showing just one solid black line, representing what had been shown as green in the previous plot. There's quite a bit of separation between this line and the identity, showing a model that's similarly as performant as it was on the training set." width="768"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, Simon Couch, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer>
</body>
</html>
