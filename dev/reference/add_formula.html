<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add formula terms to a workflow — add_formula • workflows</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add formula terms to a workflow — add_formula"><meta name="description" content="

add_formula() specifies the terms of the model through the usage of a
formula.
remove_formula() removes the formula as well as any downstream objects
that might get created after the formula is used for preprocessing, such as
terms. Additionally, if the model has already been fit, then the fit is
removed.
update_formula() first removes the formula, then replaces the previous
formula with the new one. Any model that has already been fit based on this
formula will need to be refit.

"><meta property="og:description" content="

add_formula() specifies the terms of the model through the usage of a
formula.
remove_formula() removes the formula as well as any downstream objects
that might get created after the formula is used for preprocessing, such as
terms. Additionally, if the model has already been fit, then the fit is
removed.
update_formula() first removes the formula, then replaces the previous
formula with the new one. Any model that has already been fit based on this
formula will need to be refit.

"><meta property="og:image" content="https://workflows.tidymodels.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="workflows.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">workflows</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/stages.html">Workflow Stages</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/extras/getting-started.html">Getting Started</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/workflows/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add formula terms to a workflow</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/workflows/blob/main/R/pre-action-formula.R" class="external-link"><code>R/pre-action-formula.R</code></a></small>
      <div class="d-none name"><code>add_formula.Rd</code></div>
    </div>

    <div class="ref-description section level2">

<ul><li><p><code>add_formula()</code> specifies the terms of the model through the usage of a
formula.</p></li>
<li><p><code>remove_formula()</code> removes the formula as well as any downstream objects
that might get created after the formula is used for preprocessing, such as
terms. Additionally, if the model has already been fit, then the fit is
removed.</p></li>
<li><p><code>update_formula()</code> first removes the formula, then replaces the previous
formula with the new one. Any model that has already been fit based on this
formula will need to be refit.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_formula</span><span class="op">(</span><span class="va">x</span>, <span class="va">formula</span>, <span class="va">...</span>, blueprint <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">remove_formula</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">update_formula</span><span class="op">(</span><span class="va">x</span>, <span class="va">formula</span>, <span class="va">...</span>, blueprint <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A workflow</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A formula specifying the terms of the model. It is advised to
not do preprocessing in the formula, and instead use a recipe if that is
required.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Not used.</p></dd>


<dt id="arg-blueprint">blueprint<a class="anchor" aria-label="anchor" href="#arg-blueprint"></a></dt>
<dd><p>A hardhat blueprint used for fine tuning the preprocessing.</p>
<p>If <code>NULL</code>, <code><a href="https://hardhat.tidymodels.org/reference/default_formula_blueprint.html" class="external-link">hardhat::default_formula_blueprint()</a></code> is used and is passed
arguments that best align with the model present in the workflow.</p>
<p>Note that preprocessing done here is separate from preprocessing that
might be done by the underlying model. For example, if a blueprint with
<code>indicators = "none"</code> is specified, no dummy variables will be created by
hardhat, but if the underlying model requires a formula interface that
internally uses <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">stats::model.matrix()</a></code>, factors will still be expanded to
dummy variables by the model.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>x</code>, updated with either a new or removed formula preprocessor.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>To fit a workflow, exactly one of <code>add_formula()</code>, <code><a href="add_recipe.html">add_recipe()</a></code>, or
<code><a href="add_variables.html">add_variables()</a></code> <em>must</em> be specified.</p>
    </div>
    <div class="section level2">
    <h2 id="formula-handling">Formula Handling<a class="anchor" aria-label="anchor" href="#formula-handling"></a></h2>
    <p>Note that, for different models, the formula given to <code>add_formula()</code>
might be handled in different ways, depending on the parsnip model being
used. For example, a random forest model fit using ranger would not
convert any factor predictors to binary indicator variables. This is
consistent with what <code>ranger::ranger()</code> would do, but is inconsistent
with what <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">stats::model.matrix()</a></code> would do.</p>
<p>The documentation for parsnip models provides details about how the data
given in the formula are encoded for the model if they diverge from the
standard <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix()</a></code> methodology. Our goal is to be consistent with
how the underlying model package works.</p><div class="section">
<h3 id="how-is-this-formula-used-">How is this formula used?<a class="anchor" aria-label="anchor" href="#how-is-this-formula-used-"></a></h3>


<p>To demonstrate, the example below uses <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> to fit a model. The
formula given to <code>add_formula()</code> is used to create the model matrix and
that is what is passed to <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> with a simple formula of
<code>body_mass_g ~ .</code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflows" class="external-link">workflows</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeldata.tidymodels.org" class="external-link">modeldata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/hardhat" class="external-link">hardhat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html" class="external-link">linear_reg</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"lm"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_wflow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workflow.html">workflow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_model.html">add_model</a></span><span class="op">(</span><span class="va">lm_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pre_encoded</span> <span class="op">&lt;-</span> <span class="va">lm_wflow</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_formula.html">add_formula</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">species</span> <span class="op">+</span> <span class="va">island</span> <span class="op">+</span> <span class="va">bill_depth_mm</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pre_encoded_parsnip_fit</span> <span class="op">&lt;-</span> <span class="va">pre_encoded</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_fit_parsnip</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pre_encoded_fit</span> <span class="op">&lt;-</span> <span class="va">pre_encoded_parsnip_fit</span><span class="op">$</span><span class="va">fit</span></span>
<span></span>
<span><span class="co"># The `lm()` formula is *not* the same as the `add_formula()` formula:</span></span>
<span><span class="va">pre_encoded_fit</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## stats::lm(formula = ..y ~ ., data = data)</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">##      (Intercept)  speciesChinstrap     speciesGentoo</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##        -1009.943             1.328          2236.865</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">##      islandDream   islandTorgersen     bill_depth_mm</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">##            9.221           -18.433           256.913</span></span></code></pre><p></p></div>
<p>This can affect how the results are analyzed. For example, to get
sequential hypothesis tests, each individual term is tested:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">pre_encoded_fit</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## Analysis of Variance Table</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## Response: ..y</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##                   Df    Sum Sq   Mean Sq  F value Pr(&gt;F)</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## speciesChinstrap   1  18642821  18642821 141.1482 &lt;2e-16 ***</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">## speciesGentoo      1 128221393 128221393 970.7875 &lt;2e-16 ***</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">## islandDream        1     13399     13399   0.1014 0.7503</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">## islandTorgersen    1       255       255   0.0019 0.9650</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## bill_depth_mm      1  28051023  28051023 212.3794 &lt;2e-16 ***</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## Residuals        336  44378805    132080</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="overriding-the-default-encodings">Overriding the default encodings<a class="anchor" aria-label="anchor" href="#overriding-the-default-encodings"></a></h3>


<p>Users can override the model-specific encodings by using a hardhat
blueprint. The blueprint can specify how factors are encoded and whether
intercepts are included. As an example, if you use a formula and would
like the data to be passed to a model untouched:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">minimal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/default_formula_blueprint.html" class="external-link">default_formula_blueprint</a></span><span class="op">(</span>indicators <span class="op">=</span> <span class="st">"none"</span>, intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">un_encoded</span> <span class="op">&lt;-</span> <span class="va">lm_wflow</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_formula.html">add_formula</a></span><span class="op">(</span></span>
<span>    <span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">species</span> <span class="op">+</span> <span class="va">island</span> <span class="op">+</span> <span class="va">bill_depth_mm</span>,</span>
<span>    blueprint <span class="op">=</span> <span class="va">minimal</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="va">un_encoded_parsnip_fit</span> <span class="op">&lt;-</span> <span class="va">un_encoded</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_fit_parsnip</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">un_encoded_fit</span> <span class="op">&lt;-</span> <span class="va">un_encoded_parsnip_fit</span><span class="op">$</span><span class="va">fit</span></span>
<span></span>
<span><span class="va">un_encoded_fit</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## stats::lm(formula = ..y ~ ., data = data)</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">##      (Intercept)     bill_depth_mm  speciesChinstrap</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##        -1009.943           256.913             1.328</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">##    speciesGentoo       islandDream   islandTorgersen</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">##         2236.865             9.221           -18.433</span></span></code></pre><p></p></div>
<p>While this looks the same, the raw columns were given to <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> and that
function created the dummy variables. Because of this, the sequential
ANOVA tests groups of parameters to get column-level p-values:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">un_encoded_fit</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## Analysis of Variance Table</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## Response: ..y</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##                Df    Sum Sq  Mean Sq F value Pr(&gt;F)</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## bill_depth_mm   1  48840779 48840779 369.782 &lt;2e-16 ***</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">## species         2 126067249 63033624 477.239 &lt;2e-16 ***</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">## island          2     20864    10432   0.079 0.9241</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">## Residuals     336  44378805   132080</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="overriding-the-default-model-formula">Overriding the default model formula<a class="anchor" aria-label="anchor" href="#overriding-the-default-model-formula"></a></h3>


<p>Additionally, the formula passed to the underlying model can also be
customized. In this case, the <code>formula</code> argument of <code><a href="add_model.html">add_model()</a></code> can be
used. To demonstrate, a spline function will be used for the bill depth:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span>
<span></span>
<span><span class="va">custom_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/workflow.html">workflow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_model.html">add_model</a></span><span class="op">(</span></span>
<span>    <span class="va">lm_mod</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">species</span> <span class="op">+</span> <span class="va">island</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">bill_depth_mm</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_formula.html">add_formula</a></span><span class="op">(</span></span>
<span>    <span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">species</span> <span class="op">+</span> <span class="va">island</span> <span class="op">+</span> <span class="va">bill_depth_mm</span>,</span>
<span>    blueprint <span class="op">=</span> <span class="va">minimal</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="va">custom_parsnip_fit</span> <span class="op">&lt;-</span> <span class="va">custom_formula</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_fit_parsnip</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">custom_fit</span> <span class="op">&lt;-</span> <span class="va">custom_parsnip_fit</span><span class="op">$</span><span class="va">fit</span></span>
<span></span>
<span><span class="va">custom_fit</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## stats::lm(formula = body_mass_g ~ species + island + ns(bill_depth_mm,</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##     3), data = data)</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##           (Intercept)       speciesChinstrap          speciesGentoo</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">##              1959.090                  8.534               2352.137</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">##           islandDream        islandTorgersen  ns(bill_depth_mm, 3)1</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">##                 2.425                -12.002               1476.386</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## ns(bill_depth_mm, 3)2  ns(bill_depth_mm, 3)3</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">##              3187.839               1686.996</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="altering-the-formula">Altering the formula<a class="anchor" aria-label="anchor" href="#altering-the-formula"></a></h3>


<p>Finally, when a formula is updated or removed from a fitted workflow,
the corresponding model fit is removed.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">custom_formula_no_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_formula.html">update_formula</a></span><span class="op">(</span><span class="va">custom_formula</span>, <span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">species</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_fit_parsnip</a></span><span class="op">(</span><span class="va">custom_formula_no_fit</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## Error in extract_fit_parsnip(custom_formula_no_fit) :</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##   Can't extract a model fit from an untrained workflow.</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## i Do you need to call `fit()`?</span></span></code></pre><p></p></div>
</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">workflow</span> <span class="op">&lt;-</span> <span class="fu"><a href="workflow.html">workflow</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">workflow</span> <span class="op">&lt;-</span> <span class="fu">add_formula</span><span class="op">(</span><span class="va">workflow</span>, <span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">workflow</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ══ Workflow ═══════════════════════════════════════════════════════════</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-style: italic;">Preprocessor:</span> Formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-style: italic;">Model:</span> None</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── Preprocessor ───────────────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mpg ~ cyl</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">remove_formula</span><span class="op">(</span><span class="va">workflow</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ══ Workflow ═══════════════════════════════════════════════════════════</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-style: italic;">Preprocessor:</span> None</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-style: italic;">Model:</span> None</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">update_formula</span><span class="op">(</span><span class="va">workflow</span>, <span class="va">mpg</span> <span class="op">~</span> <span class="va">disp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ══ Workflow ═══════════════════════════════════════════════════════════</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-style: italic;">Preprocessor:</span> Formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-style: italic;">Model:</span> None</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── Preprocessor ───────────────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mpg ~ disp</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, Simon Couch, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer></body></html>

